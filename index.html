<!DOCTYPE html>
<html>
<head>
    <!-- Mantener misma sección head del código original -->
    <style>
        /* Añadir nuevos estilos para controles de movimiento */
        .movement-controls {
            position: fixed;
            bottom: 180px;
            left: 0;
            right: 0;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            padding: 10px;
            z-index: 1000;
        }

        .movement-button {
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: 1px solid #fff;
            padding: 15px;
            border-radius: 50%;
            cursor: pointer;
            touch-action: manipulation;
        }

        .axis-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
            position: fixed;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
        }
    </style>
</head>
<body>
    <div id="statusIndicator" class="status-indicator">Buscando marcador...</div>
    
    <!-- Nuevos controles de movimiento -->
    <div class="movement-controls">
        <button class="movement-button" id="btnLeft">←</button>
        <button class="movement-button" id="btnForward">↑</button>
        <button class="movement-button" id="btnRight">→</button>
        <button class="movement-button" id="btnBackward">↓</button>
    </div>

    <div class="axis-controls">
        <button class="movement-button" id="btnUp">↑</button>
        <button class="movement-button" id="btnDown">↓</button>
    </div>

    <!-- Botones originales de grupos -->
    <div class="button-container">
        <!-- Mantener botones originales de grupos -->
    </div>

    <a-scene embedded arjs>
        <a-marker id="miMarcador" type="pattern" url="zona1.patt">
            <!-- Modificar grupos para incluir posición inicial -->
            <a-entity id="grupo1" visible="true">
                <a-box data-initial-position="0 0.5 0" ...></a-box>
                <a-box data-initial-position="1.5 0.5 0" ...></a-box>
            </a-entity>
            <!-- Repetir para otros grupos -->
        </a-marker>
        <a-entity camera></a-entity>
    </a-scene>

    <script>
        // Nuevas variables de control
        let movimientoHabilitado = false;
        const STEP_SIZE = 0.1; // Tamaño del paso de movimiento

        // Función para bloquear/mover objetos
        function actualizarPosicion(direccion) {
            const grupoActual = grupos[grupoActualIndex].element;
            const objetos = grupoActual.querySelectorAll('[data-initial-position]');
            
            objetos.forEach(obj => {
                const pos = obj.getAttribute('position');
                const initialPos = obj.dataset.initialPosition.split(' ').map(Number);
                
                // Calcular nueva posición relativa
                let newPos = {
                    x: initialPos[0] + (pos.x - initialPos[0]),
                    y: initialPos[1] + (pos.y - initialPos[1]),
                    z: initialPos[2] + (pos.z - initialPos[2])
                };

                // Aplicar movimiento según dirección
                switch(direccion) {
                    case 'left': newPos.x -= STEP_SIZE; break;
                    case 'right': newPos.x += STEP_SIZE; break;
                    case 'forward': newPos.z -= STEP_SIZE; break;
                    case 'backward': newPos.z += STEP_SIZE; break;
                    case 'up': newPos.y += STEP_SIZE; break;
                    case 'down': newPos.y -= STEP_SIZE; break;
                }

                obj.setAttribute('position', `${newPos.x} ${newPos.y} ${newPos.z}`);
            });
        }

        // Event listeners para botones
        document.getElementById('btnLeft').addEventListener('mousedown', () => actualizarPosicion('left'));
        document.getElementById('btnRight').addEventListener('mousedown', () => actualizarPosicion('right'));
        document.getElementById('btnForward').addEventListener('mousedown', () => actualizarPosicion('forward'));
        document.getElementById('btnBackward').addEventListener('mousedown', () => actualizarPosicion('backward'));
        document.getElementById('btnUp').addEventListener('mousedown', () => actualizarPosicion('up'));
        document.getElementById('btnDown').addEventListener('mousedown', () => actualizarPosicion('down'));

        // Bloquear actualización automática de posición
        const marker = document.getElementById('miMarcador');
        marker.addEventListener('markerFound', () => {
            const objetos = document.querySelectorAll('[data-initial-position]');
            objetos.forEach(obj => {
                if(!obj.dataset.initialPositionSet) {
                    const pos = obj.getAttribute('position');
                    obj.dataset.initialPosition = `${pos.x} ${pos.y} ${pos.z}`;
                    obj.dataset.initialPositionSet = true;
                }
            });
        });
    </script>
</body>
</html>
