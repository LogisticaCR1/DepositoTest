<html>
  <head>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/jeromeetienne/ar.js/2.2.1/aframe/build/aframe-ar.js"></script>
  </head>
  <body style="margin: 0; overflow: hidden;">
    <a-scene embedded arjs>
      
      <!-- Cámara -->
      <a-entity camera></a-entity>

      <!-- Marcadores -->
      <a-marker id="marker1" type="pattern" url="patt1.patt"></a-marker>
      <a-marker id="marker2" type="pattern" url="patt2.patt"></a-marker>
      <a-marker id="marker3" type="pattern" url="patt3.patt"></a-marker>
      <a-marker id="marker4" type="pattern" url="patt4.patt"></a-marker>

      <!-- Nodo para contener los cubos fijos -->
      <a-entity id="persistent-cubes"></a-entity>

    </a-scene>

    <script>
      const markers = ['marker1', 'marker2', 'marker3', 'marker4'];
      const cubeColors = ['red', 'blue', 'green', 'yellow'];
      const createdCubes = {};

      markers.forEach((markerId, index) => {
        const marker = document.querySelector(`#${markerId}`);
        marker.addEventListener('markerFound', () => {
          const markerPos = marker.object3D.position.clone();
          const markerRot = marker.object3D.rotation.clone();

          // Si no se creó el cubo aún
          if (!createdCubes[markerId]) {
            const scene = document.querySelector('#persistent-cubes');
            const box = document.createElement('a-box');
            box.setAttribute('position', markerPos);
            box.setAttribute('rotation', {
              x: THREE.Math.radToDeg(markerRot.x),
              y: THREE.Math.radToDeg(markerRot.y),
              z: THREE.Math.radToDeg(markerRot.z)
            });
            box.setAttribute('color', cubeColors[index]);
            box.setAttribute('depth', 0.3);
            box.setAttribute('height', 0.3);
            box.setAttribute('width', 0.3);
            scene.appendChild(box);
            createdCubes[markerId] = box;
          } else {
            // Si ya existe, actualizar su posición
            createdCubes[markerId].setAttribute('position', markerPos);
            createdCubes[markerId].setAttribute('rotation', {
              x: THREE.Math.radToDeg(markerRot.x),
              y: THREE.Math.radToDeg(markerRot.y),
              z: THREE.Math.radToDeg(markerRot.z)
            });
          }
        });
      });
    </script>
  </body>
</html>
